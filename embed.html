<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyirok Reservation System</title>
    <!-- Load React development versions for better error messages -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Load Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- Load Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Medical theme styles */
        .medical-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }

        .medical-step-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
        }

        .medical-step-active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .medical-step-completed {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .medical-step-pending {
            background: #f8fafc;
            color: #64748b;
            border-color: #e2e8f0;
        }

        .medical-progress-bar {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }

        .medical-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        .medical-option-card {
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }

        .medical-option-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
            transform: translateY(-1px);
        }

        .medical-option-selected {
            border-color: #3b82f6;
            background: #dbeafe;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .medical-option-disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8fafc;
        }

        .medical-option-disabled:hover {
            transform: none;
            box-shadow: none;
            border-color: #e2e8f0;
        }

        .medical-button-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .medical-button-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }

        .medical-button-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .medical-button-secondary {
            background: white;
            color: #64748b;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .medical-button-secondary:hover:not(:disabled) {
            border-color: #3b82f6;
            color: #3b82f6;
            transform: translateY(-1px);
        }

        .medical-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s ease;
            background: white;
        }

        .medical-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Ensure the container is visible */
        #reservation-root {
            min-height: 400px;
            width: 100%;
            display: block !important;
            visibility: visible !important;
        }

        /* Fallback if React fails to load */
        .loading-fallback {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            font-size: 18px;
            color: #64748b;
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }

        .error-message {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            font-size: 16px;
            color: #dc2626;
            border: 2px solid #fecaca;
            border-radius: 8px;
            background: #fef2f2;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="reservation-root">
        <div class="loading-fallback">Foglalási rendszer betöltése...</div>
    </div>

    <script type="text/babel">
        // Check if all dependencies are loaded
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined' || typeof supabase === 'undefined') {
            console.error('Required dependencies not loaded:', {
                React: typeof React,
                ReactDOM: typeof ReactDOM,
                supabase: typeof supabase
            });
            document.getElementById('reservation-root').innerHTML = '<div class="error-message">Hiba: A szükséges függvények nem töltődtek be. Kérjük ellenőrizze az internetkapcsolatot.</div>';
        } else {
            console.log('All dependencies loaded successfully');
            
            const { useState, useEffect } = React;
            const { createClient } = supabase;

            // Initialize Supabase client with correct credentials
            const supabaseClient = createClient(
                'https://aispzwadwdikqmtpmqii.supabase.co',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpc3B6d2Fkd2Rpa3FtdHBtcWlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjUwODYsImV4cCI6MjA2OTIwMTA4Nn0.OAziuXL-MAV60ZvrbD_77SmIttcbE113zKjwYsZ-0yE'
            );

            // Icon components using SVG for better consistency
            const CalendarIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
            );

            const ClockIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12,6 12,12 16,14"></polyline>
                </svg>
            );

            const MapPinIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                </svg>
            );

            const UserIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            );

            const StethoscopeIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"></path>
                    <path d="M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"></path>
                    <circle cx="20" cy="10" r="2"></circle>
                </svg>
            );

            const CreditCardIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                    <line x1="1" y1="10" x2="23" y2="10"></line>
                </svg>
            );

            const CheckCircleIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22,4 12,14.01 9,11.01"></polyline>
                </svg>
            );

            const ChevronRightIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <polyline points="9,18 15,12 9,6"></polyline>
                </svg>
            );

            const ChevronLeftIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <polyline points="15,18 9,12 15,6"></polyline>
                </svg>
            );

            const MailIcon = () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
            );

            const PhoneIcon = () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
            );

            const icons = {
                Calendar: CalendarIcon,
                Clock: ClockIcon,
                MapPin: MapPinIcon,
                User: UserIcon,
                Stethoscope: StethoscopeIcon,
                CreditCard: CreditCardIcon,
                CheckCircle: CheckCircleIcon,
                ChevronRight: ChevronRightIcon,
                ChevronLeft: ChevronLeftIcon,
                Mail: MailIcon,
                Phone: PhoneIcon
            };

            const STATEMENTS = [
                "Szív problémám vagy pacemakerem van",
                "Nem rég műtöttek vagy csonkolásos műtéten estem át", 
                "Nyílt vagy fekélyes sebem van",
                "Sztómával rendelkezem",
                "Kiskorú gyerek kezelését igénylem",
                "A fentiek közül egyik sem érvényes rám nézve"
            ];

            const TIME_SLOTS = [
                "08:00", "09:00", "10:00", "11:00", "12:00", 
                "13:00", "14:00", "15:00", "16:00", "17:00"
            ];

            const STEPS = [
                { id: 1, title: "Nyilatkozat", icon: 'CheckCircle' },
                { id: 2, title: "Helyszín", icon: 'MapPin' },
                { id: 3, title: "Dátum", icon: 'Calendar' },
                { id: 4, title: "Időpont", icon: 'Clock' },
                { id: 5, title: "Terapeuta", icon: 'User' },
                { id: 6, title: "Szolgáltatás", icon: 'Stethoscope' },
                { id: 7, title: "Adatok", icon: 'CreditCard' },
                { id: 8, title: "Összegzés", icon: 'CheckCircle' }
            ];

            function ReservationSystem() {
                console.log('ReservationSystem component rendering');
                
                const [currentStep, setCurrentStep] = useState(1);
                const [formData, setFormData] = useState({
                    statements: [],
                    location: null,
                    date: '',
                    time: '',
                    therapist: null,
                    service: null,
                    personalData: { fullName: '', email: '', phone: '' }
                });

                const [locations, setLocations] = useState([]);
                const [personnel, setPersonnel] = useState([]);
                const [services, setServices] = useState([]);
                const [reservations, setReservations] = useState([]);
                const [availableTimeSlots, setAvailableTimeSlots] = useState([]);
                const [loading, setLoading] = useState(false);
                const [calendarDate, setCalendarDate] = useState(new Date());

                // Load initial data
                useEffect(() => {
                    console.log('Loading initial data...');
                    loadLocations();
                    loadPersonnel();
                    loadServices();
                }, []);

                // Load reservations when date changes
                useEffect(() => {
                    if (formData.date) {
                        console.log('Loading reservations for date:', formData.date);
                        loadReservations();
                    }
                }, [formData.date]);

                // Calculate available time slots
                useEffect(() => {
                    if (formData.location && formData.date) {
                        console.log('Calculating available time slots...');
                        calculateAvailableTimeSlots();
                    }
                }, [formData.location, formData.date, personnel, reservations]);

                const loadLocations = async () => {
                    try {
                        console.log('Loading locations...');
                        const { data, error } = await supabaseClient
                            .from('nyirok_locations')
                            .select('*');
                        
                        if (data && !error) {
                            console.log('Locations loaded:', data);
                            setLocations(data);
                        } else {
                            console.error('Error loading locations:', error);
                        }
                    } catch (error) {
                        console.error('Error loading locations:', error);
                    }
                };

                const loadPersonnel = async () => {
                    try {
                        console.log('Loading personnel...');
                        const { data, error } = await supabaseClient
                            .from('nyirok_personnel')
                            .select('*');
                        
                        if (data && !error) {
                            console.log('Personnel loaded:', data);
                            setPersonnel(data);
                        } else {
                            console.error('Error loading personnel:', error);
                        }
                    } catch (error) {
                        console.error('Error loading personnel:', error);
                    }
                };

                const loadServices = async () => {
                    try {
                        console.log('Loading services...');
                        const { data, error } = await supabaseClient
                            .from('nyirok_services')
                            .select('*');
                        
                        if (data && !error) {
                            console.log('Services loaded:', data);
                            setServices(data);
                        } else {
                            console.error('Error loading services:', error);
                        }
                    } catch (error) {
                        console.error('Error loading services:', error);
                    }
                };

                const loadReservations = async () => {
                    try {
                        console.log('Loading reservations for date:', formData.date);
                        const { data, error } = await supabaseClient
                            .from('nyirok_reservations')
                            .select('*')
                            .eq('date', formData.date);
                        
                        if (data && !error) {
                            console.log('Reservations loaded:', data);
                            setReservations(data);
                        } else {
                            console.error('Error loading reservations:', error);
                        }
                    } catch (error) {
                        console.error('Error loading reservations:', error);
                    }
                };

                const requiresExpert = () => {
                    return !formData.statements.includes("A fentiek közül egyik sem érvényes rám nézve");
                };

                const getAvailableTherapists = () => {
                    if (!formData.location) return [];
                    
                    return personnel.filter(p => {
                        if (p.location_id !== formData.location?.id) return false;
                        if (requiresExpert() && !p.expert) return false;
                        return true;
                    });
                };

                const calculateAvailableTimeSlots = () => {
                    const availableTherapists = getAvailableTherapists();
                    const available = [];

                    TIME_SLOTS.forEach(timeSlot => {
                        const hasAvailableTherapist = availableTherapists.some(therapist => {
                            return !reservations.some(reservation => 
                                reservation.therapist_link === therapist.id && 
                                reservation.time === timeSlot
                            );
                        });

                        if (hasAvailableTherapist) {
                            available.push(timeSlot);
                        }
                    });

                    console.log('Available time slots:', available);
                    setAvailableTimeSlots(available);
                };

                const getAvailableTherapistsForTimeSlot = () => {
                    if (!formData.time) return [];
                    
                    const availableTherapists = getAvailableTherapists();
                    
                    return availableTherapists.filter(therapist => {
                        return !reservations.some(reservation => 
                            reservation.therapist_link === therapist.id && 
                            reservation.time === formData.time
                        );
                    });
                };

                const getAvailableServicesForTherapist = () => {
                    if (!formData.therapist) return services;
                    
                    return services.filter(service => {
                        return formData.therapist.service_ids && formData.therapist.service_ids.includes(service.id);
                    });
                };

                const handleStatementChange = (statement) => {
                    const isLastStatement = statement === "A fentiek közül egyik sem érvényes rám nézve";
                    
                    if (isLastStatement) {
                        setFormData(prev => ({ ...prev, statements: [statement] }));
                    } else {
                        setFormData(prev => ({
                            ...prev,
                            statements: prev.statements.includes(statement)
                                ? prev.statements.filter(s => s !== statement && s !== "A fentiek közül egyik sem érvényes rám nézve")
                                : [...prev.statements.filter(s => s !== "A fentiek közül egyik sem érvényes rám nézve"), statement]
                        }));
                    }
                };

                const handleNext = () => {
                    if (currentStep < 8) {
                        setCurrentStep(prev => prev + 1);
                    }
                };

                const handleBack = () => {
                    if (currentStep > 1) {
                        setCurrentStep(prev => prev - 1);
                    }
                };

                const canProceed = () => {
                    switch (currentStep) {
                        case 1: return formData.statements.length > 0;
                        case 2: return formData.location !== null;
                        case 3: return formData.date !== '';
                        case 4: return formData.time !== '';
                        case 5: return formData.therapist !== null;
                        case 6: return formData.service !== null;
                        case 7: return formData.personalData.fullName.trim() !== '' && 
                                       formData.personalData.email.trim() !== '' && 
                                       formData.personalData.phone.trim() !== '';
                        default: return false;
                    }
                };

                const handleSubmit = async () => {
                    if (!formData.therapist || !formData.service || !formData.location) return;
                    
                    setLoading(true);
                    console.log('Submitting reservation...');
                    
                    try {
                        const reservationData = {
                            name: formData.personalData.fullName,
                            email: formData.personalData.email,
                            phone: formData.personalData.phone,
                            date: formData.date,
                            time: formData.time,
                            location: formData.location.name,
                            therapist: formData.therapist.name,
                            therapist_link: formData.therapist.id,
                            service: formData.service.name,
                            notes: `Statements: ${formData.statements.join(', ')}`
                        };

                        console.log('Reservation data:', reservationData);

                        const { error } = await supabaseClient
                            .from('nyirok_reservations')
                            .insert([reservationData]);

                        if (!error) {
                            alert('Foglalás sikeresen létrehozva!');
                            setFormData({
                                statements: [],
                                location: null,
                                date: '',
                                time: '',
                                therapist: null,
                                service: null,
                                personalData: { fullName: '', email: '', phone: '' }
                            });
                            setCurrentStep(1);
                        } else {
                            console.error('Submission error:', error);
                            alert('Hiba történt a foglalás során. Kérjük próbálja újra.');
                        }
                    } catch (error) {
                        console.error('Submit error:', error);
                        alert('Hiba történt a foglalás során. Kérjük próbálja újra.');
                    }
                    
                    setLoading(false);
                };

                const getDaysInMonth = (date) => {
                    return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
                };

                const getFirstDayOfMonth = (date) => {
                    const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
                    return firstDay === 0 ? 6 : firstDay - 1;
                };

                const isDateDisabled = (date) => {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return date < today;
                };

                const navigateCalendar = (direction) => {
                    setCalendarDate(prev => {
                        const newDate = new Date(prev);
                        if (direction === 'prev') {
                            newDate.setMonth(newDate.getMonth() - 1);
                        } else {
                            newDate.setMonth(newDate.getMonth() + 1);
                        }
                        return newDate;
                    });
                };

                const handleDateSelect = (day) => {
                    const selectedDate = new Date(calendarDate.getFullYear(), calendarDate.getMonth(), day);
                    const year = selectedDate.getFullYear();
                    const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                    const dayStr = String(selectedDate.getDate()).padStart(2, '0');
                    const dateString = `${year}-${month}-${dayStr}`;
                    setFormData(prev => ({ ...prev, date: dateString }));
                };

                const renderCalendar = () => {
                    const daysInMonth = getDaysInMonth(calendarDate);
                    const firstDay = getFirstDayOfMonth(calendarDate);
                    const today = new Date();
                    const selectedDate = formData.date ? new Date(formData.date + 'T00:00:00') : null;
                    
                    const monthNames = [
                        'Január', 'Február', 'Március', 'Április', 'Május', 'Június',
                        'Július', 'Augusztus', 'Szeptember', 'Október', 'November', 'December'
                    ];
                    
                    const dayNames = ['H', 'K', 'Sz', 'Cs', 'P', 'Sz', 'V'];
                    
                    const days = [];
                    
                    for (let i = 0; i < firstDay; i++) {
                        days.push(<div key={`empty-${i}`} style={{height: '40px', width: '40px'}} />);
                    }
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const date = new Date(calendarDate.getFullYear(), calendarDate.getMonth(), day);
                        const isDisabled = isDateDisabled(date);
                        const isSelected = selectedDate && 
                            date.getFullYear() === selectedDate.getFullYear() &&
                            date.getMonth() === selectedDate.getMonth() &&
                            date.getDate() === selectedDate.getDate();
                        const isToday = 
                            date.getFullYear() === today.getFullYear() &&
                            date.getMonth() === today.getMonth() &&
                            date.getDate() === today.getDate();
                        
                        let className = 'h-10 w-10 rounded-lg text-sm font-medium transition-colors ';
                        if (isSelected) {
                            className += 'bg-blue-600 text-white';
                        } else if (isToday) {
                            className += 'bg-blue-100 text-blue-600';
                        } else if (isDisabled) {
                            className += 'text-slate-300 cursor-not-allowed';
                        } else {
                            className += 'hover:bg-slate-100 text-slate-700';
                        }
                        
                        days.push(
                            <button
                                key={day}
                                onClick={() => handleDateSelect(day)}
                                disabled={isDisabled}
                                className={className}
                                style={{height: '40px', width: '40px'}}
                            >{day}</button>
                        );
                    }
                    
                    return (
                        <div className="bg-white rounded-lg border border-slate-200 p-4">
                            <div className="flex items-center justify-between mb-4">
                                <button
                                    onClick={() => navigateCalendar('prev')}
                                    className="p-1 hover:bg-slate-100 rounded"
                                >
                                    <ChevronLeftIcon />
                                </button>
                                <h3 className="text-lg font-semibold text-slate-800">
                                    {`${monthNames[calendarDate.getMonth()]} ${calendarDate.getFullYear()}`}
                                </h3>
                                <button
                                    onClick={() => navigateCalendar('next')}
                                    className="p-1 hover:bg-slate-100 rounded"
                                >
                                    <ChevronRightIcon />
                                </button>
                            </div>
                            <div className="grid grid-cols-7 gap-1 mb-2">
                                {dayNames.map(day => (
                                    <div key={day} style={{height: '40px', width: '40px'}} className="flex items-center justify-center text-sm font-medium text-slate-500">
                                        {day}
                                    </div>
                                ))}
                            </div>
                            <div className="grid grid-cols-7 gap-1">
                                {days}
                            </div>
                        </div>
                    );
                };

                const renderProgressBar = () => {
                    const progress = (currentStep / 8) * 100;
                    
                    return (
                        <div className="mb-8">
                            <div className="flex justify-between items-center mb-4">
                                {STEPS.map((step) => {
                                    const Icon = icons[step.icon];
                                    const isActive = currentStep === step.id;
                                    const isCompleted = currentStep > step.id;
                                    
                                    return (
                                        <div key={step.id} className="flex flex-col items-center">
                                            <div className={`medical-step-indicator ${
                                                isCompleted ? 'medical-step-completed' : 
                                                isActive ? 'medical-step-active' : 'medical-step-pending'
                                            }`}>
                                                <Icon />
                                            </div>
                                            <span className="text-xs mt-2 text-center max-w-16">{step.title}</span>
                                        </div>
                                    );
                                })}
                            </div>
                            <div className="medical-progress-bar">
                                <div 
                                    className="medical-progress-fill" 
                                    style={{ width: `${progress}%` }}
                                />
                            </div>
                        </div>
                    );
                };

                const renderStep = () => {
                    switch (currentStep) {
                        case 1:
                            return (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Nyilatkozat</h2>
                                        <p className="text-slate-600">Az időpontfoglalás előtt kérem jelölje be, ha az alábbiak közül valamelyik érvényes önre. Ez alapján az önnek leginkább megfelelő terapeutát tudjuk kiválasztani.</p>
                                    </div>
                                    <div className="space-y-3">
                                        {STATEMENTS.map((statement, index) => (
                                            <div
                                                key={index}
                                                className={`medical-option-card ${formData.statements.includes(statement) ? 'medical-option-selected' : ''}`}
                                                onClick={() => handleStatementChange(statement)}
                                            >
                                                <div className="flex items-start space-x-3">
                                                    <input
                                                        type="checkbox"
                                                        checked={formData.statements.includes(statement)}
                                                        onChange={() => {}}
                                                        className="mt-1 rounded border-slate-300 text-blue-600 focus:ring-blue-500"
                                                    />
                                                    <label className={`text-slate-700 cursor-pointer ${index === STATEMENTS.length - 1 ? 'font-semibold' : ''}`}>
                                                        {statement}
                                                    </label>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            );

                        case 2:
                            return (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Válassz helyszínt</h2>
                                        <p className="text-slate-600">Hol szeretnéd igénybe venni a szolgáltatást?</p>
                                    </div>
                                    <div className="grid gap-4">
                                        {locations.map((location) => (
                                            <div
                                                key={location.id}
                                                className={`medical-option-card ${formData.location?.id === location.id ? 'medical-option-selected' : ''}`}
                                                onClick={() => setFormData(prev => ({ ...prev, location }))}
                                            >
                                                <div className="flex items-center space-x-3">
                                                    <MapPinIcon />
                                                    <div>
                                                        <h3 className="font-semibold text-slate-800">{location.name}</h3>
                                                        <p className="text-slate-600 text-sm">{location.location}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            );

                        case 3:
                            return (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Válassz dátumot</h2>
                                        <p className="text-slate-600">Mikor szeretnél időpontot foglalni?</p>
                                    </div>
                                    <div className="flex justify-center">
                                        {renderCalendar()}
                                    </div>
                                </div>
                            );

                        case 4:
                            return (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Válassz időpontot</h2>
                                        <p className="text-slate-600">Milyen időpontban szeretnél időpontot?</p>
                                    </div>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        {TIME_SLOTS.map((timeSlot) => {
                                            const isAvailable = availableTimeSlots.includes(timeSlot);
                                            return (
                                                <div
                                                    key={timeSlot}
                                                    className={`medical-option-card ${
                                                        formData.time === timeSlot ? 'medical-option-selected' : 
                                                        !isAvailable ? 'medical-option-disabled' : ''
                                                    }`}
                                                    onClick={() => isAvailable && setFormData(prev => ({ ...prev, time: timeSlot }))}
                                                >
                                                    <div className="flex items-center justify-center space-x-2">
                                                        <ClockIcon />
                                                        <span className={`font-medium ${isAvailable ? 'text-slate-800' : 'text-slate-400'}`}>
                                                            {timeSlot}
                                                        </span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>  
                                </div>
                            );

                        case 5:
                            const availableTherapists = getAvailableTherapistsForTimeSlot();
                            return (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Válassz terapeutát</h2>
                                        <p className="text-slate-600">Ki végezze el a kezelést?</p>
                                    </div>
                                    <div className="space-y-4">
                                        {availableTherapists.map((therapist) => (
                                            <div
                                                key={therapist.id}
                                                className={`medical-option-card ${formData.therapist?.id === therapist.id ? 'medical-option-selected' : ''}`}
                                                onClick={() => setFormData(prev => ({ ...prev, therapist }))}
                                            >
                                                <div className="flex items-start space-x-3">
                                                    <UserIcon />
                                                    <div className="flex-1">
                                                        <div className="flex items-center space-x-2">
                                                            <h3 className="font-semibold text-slate-800">{therapist.name}</h3>
                                                            {therapist.expert && (
                                                                <span className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                                                                    Szakértő
                                                                </span>
                                                            )}
                                                        </div>
                                                        <p className="text-slate-600 text-sm">{therapist.role}</p>
                                                        {therapist.description && (
                                                            <p className="text-slate-500 text-sm mt-1">{therapist.description}</p>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            );

                        case 6:
                            const availableServices = getAvailableServicesForTherapist();
                            return (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Válassz szolgáltatást</h2>
                                        <p className="text-slate-600">Melyik kezelést szeretnéd?</p>
                                    </div>
                                    <div className="space-y-4">
                                        {availableServices.map((service) => (
                                            <div
                                                key={service.id}
                                                className={`medical-option-card ${formData.service?.id === service.id ? 'medical-option-selected' : ''}`}
                                                onClick={() => setFormData(prev => ({ ...prev, service }))}
                                            >
                                                <div className="flex items-start space-x-3">
                                                    <StethoscopeIcon />
                                                    <div className="flex-1">
                                                        <div className="flex justify-between items-start">
                                                            <div>
                                                                <h3 className="font-semibold text-slate-800">{service.name}</h3>
                                                                {service.description && (
                                                                    <p className="text-slate-600 text-sm mt-1">{service.description}</p>
                                                                )}
                                                                <p className="text-slate-500 text-sm mt-1">{service.time} perc</p>
                                                            </div>
                                                            <span className="text-blue-600 font-bold text-lg">
                                                                {service.price.toLocaleString()} Ft
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            );

                        case 7:
                            return (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Személyes adatok</h2>
                                        <p className="text-slate-600">Kérjük, adja meg az alábbi adatokat</p>
                                    </div>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Teljes név *</label>
                                            <input
                                                type="text"
                                                className="medical-input"
                                                placeholder="Adja meg a teljes nevét"
                                                value={formData.personalData.fullName}
                                                onChange={(e) => setFormData(prev => ({
                                                    ...prev,
                                                    personalData: { ...prev.personalData, fullName: e.target.value }
                                                }))}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">E-mail cím *</label>
                                            <div className="relative">
                                                <div style={{position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)', color: '#64748b'}}>
                                                    <MailIcon />
                                                </div>
                                                <input
                                                    type="email"
                                                    className="medical-input"
                                                    style={{paddingLeft: '40px'}}
                                                    placeholder="pelda@email.hu"
                                                    value={formData.personalData.email}
                                                    onChange={(e) => setFormData(prev => ({
                                                        ...prev,
                                                        personalData: { ...prev.personalData, email: e.target.value }
                                                    }))}
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Telefonszám *</label>
                                            <div className="relative">
                                                <div style={{position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)', color: '#64748b'}}>
                                                    <PhoneIcon />
                                                </div>
                                                <input
                                                    type="tel"
                                                    className="medical-input"
                                                    style={{paddingLeft: '40px'}}
                                                    placeholder="+36 30 123 4567"
                                                    value={formData.personalData.phone}
                                                    onChange={(e) => setFormData(prev => ({
                                                        ...prev,
                                                        personalData: { ...prev.personalData, phone: e.target.value }
                                                    }))}
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            );

                        case 8:
                            return (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Összegzés</h2>
                                        <p className="text-slate-600">Ellenőrizd a foglalás adatait</p>
                                    </div>
                                    <div className="bg-slate-50 rounded-xl p-6 space-y-4">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <h4 className="font-medium text-slate-700 mb-2">Helyszín</h4>
                                                <p className="text-slate-900">{formData.location?.name}</p>
                                                <p className="text-slate-600 text-sm">{formData.location?.location}</p>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-slate-700 mb-2">Időpont</h4>
                                                <p className="text-slate-900">{formData.date}</p>
                                                <p className="text-slate-600 text-sm">{formData.time}</p>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-slate-700 mb-2">Terapeuta</h4>
                                                <p className="text-slate-900">{formData.therapist?.name}</p>
                                                <p className="text-slate-600 text-sm">{formData.therapist?.role}</p>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-slate-700 mb-2">Szolgáltatás</h4>
                                                <p className="text-slate-900">{formData.service?.name}</p>
                                                <p className="text-slate-600 text-sm">{formData.service?.price.toLocaleString()} Ft</p>
                                            </div>
                                            <div style={{gridColumn: 'span 2'}}>
                                                <h4 className="font-medium text-slate-700 mb-2">Személyes adatok</h4>
                                                <p className="text-slate-900">{formData.personalData.fullName}</p>
                                                <p className="text-slate-600 text-sm">{formData.personalData.email}</p>
                                                <p className="text-slate-600 text-sm">{formData.personalData.phone}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            );

                        default:
                            return null;
                    }
                };

                return (
                    <div className="max-w-4xl mx-auto p-6">
                        <div className="medical-container p-8">
                            {renderProgressBar()}
                            <div style={{minHeight: '384px'}}>
                                {renderStep()}
                            </div>
                            <div className="flex justify-between mt-8 pt-6 border-t border-slate-200">
                                <button
                                    onClick={handleBack}
                                    disabled={currentStep === 1}
                                    className="medical-button-secondary flex items-center space-x-2 disabled:opacity-50"
                                >
                                    <ChevronLeftIcon />
                                    <span>Vissza</span>
                                </button>
                                {currentStep === 8 ?
                                    <button
                                        onClick={handleSubmit}
                                        disabled={loading}
                                        className="medical-button-primary flex items-center space-x-2"
                                    >
                                        <span>{loading ? 'Foglalás...' : 'Foglalás véglegesítése'}</span>
                                        <CheckCircleIcon />
                                    </button>
                                    :
                                    <button
                                        onClick={handleNext}
                                        disabled={!canProceed()}
                                        className="medical-button-primary flex items-center space-x-2"
                                    >
                                        <span>Tovább</span>
                                        <ChevronRightIcon />
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                );
            }

            // Render the component
            console.log('Rendering ReservationSystem...');
            const root = ReactDOM.createRoot(document.getElementById('reservation-root'));
            root.render(<ReservationSystem />);
            console.log('Component rendered successfully');
        }
    </script>
</body>
</html>
